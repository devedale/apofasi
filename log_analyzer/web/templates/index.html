<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Analyzer & Anonymizer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Log Analyzer & Anonymizer</h1>

        <div class="tab-bar">
            <button class="tab-button active" data-tab="analysis-tab">Analysis</button>
            <button class="tab-button" data-tab="config-tab">Configuration</button>
            <button class="tab-button" data-tab="model-management-tab">Model Management</button>
            <button class="tab-button" data-tab="logppt-tab">LogPPT</button>
        </div>

        <div id="status-banner" class="status-banner" style="display: none;"></div>

        <!-- Analysis Tab Content -->
        <div id="analysis-tab" class="tab-content active">
            <h2>Run Analysis Pipeline</h2>
            <div class="info-box">
                <h3>ðŸ“Š Analysis Options</h3>
                <p><strong>Anonymize Only:</strong> Generates anonymized log files using AI-powered PII detection.</p>
                <p><strong>Generate LogPPT Report:</strong> Creates structured CSV reports for LogPPT analysis with both original and anonymized data.</p>
                <p><strong>Generate Unified JSON:</strong> Exports comprehensive analysis results in JSON format.</p>
                <p><strong>Export CSV:</strong> Creates clean, structured CSV files optimized for spreadsheet applications. Automatically handles problematic characters (commas, quotes, newlines) to ensure compatibility.</p>
                <p><strong>Analyze Data Different Values:</strong> Generates Excel report with unique values analysis and field insights. Perfect for data exploration and understanding field types, patterns, and distributions.</p>
            </div>
            <div class="analysis-controls">
                <div class="form-group">
                    <label for="analysis-file-select">Select Input File from Examples</label>
                    <select id="analysis-file-select"></select>
                </div>
                <div class="analysis-buttons">
                    <button id="run-anonymize-btn" class="analysis-btn" data-analysis-type="anonymize">Anonymize Only</button>
                    <button id="run-logppt-btn" class="analysis-btn" data-analysis-type="logppt">Generate LogPPT Report</button>
                    <button id="run-json-btn" class="analysis-btn" data-analysis-type="json_report">Generate Unified JSON</button>
                    <button id="run-csv-export-btn" class="analysis-btn" data-analysis-type="csv_export">Export CSV</button>
                    <button id="run-excel-analysis-btn" class="analysis-btn" data-analysis-type="excel_analysis">Analyze Data Different Values</button>
                </div>
            </div>
            <div id="analysis-results" class="analysis-results" style="display: none;">
                <h3>Processing Complete</h3>
                <p id="analysis-status-message"></p>
                <a id="download-link" href="#" target="_blank">Download Result</a>
            </div>
        </div>

        <!-- Configuration Tab Content -->
        <div id="config-tab" class="tab-content">
            <form id="config-form">
                <fieldset>
                    <legend>Core Settings</legend>
                    <div class="form-group">
                        <label for="presidio-enabled">Enable Presidio Anonymization</label>
                        <input type="checkbox" id="presidio-enabled" name="presidio.enabled">
                    </div>
                    <div class="form-group">
                        <label for="presidio-confidence">Presidio Confidence Threshold</label>
                        <input type="number" id="presidio-confidence" name="presidio.analyzer.analysis.confidence_threshold" min="0" max="1" step="0.05">
                    </div>
                    <div class="form-group">
                        <label for="presidio-language">Language</label>
                        <select id="presidio-language" name="presidio.analyzer.language">
                            <option value="en">English</option>
                            <option value="it">Italiano</option>
                        </select>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Entities & Strategies</legend>
                    <div class="table-container">
                        <table id="entities-table">
                            <thead>
                                <tr>
                                    <th>Entity</th>
                                    <th>Enabled</th>
                                    <th>Strategy</th>
                                    <th>Regex Pattern</th>
                                    <th>Default Score</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Custom Regex Recognizers</legend>
                    <div class="table-container">
                        <table id="regex-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Regex Pattern</th>
                                    <th>Score</th>
                                    <th>Strategy</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="add-regex-btn">Add Recognizer</button>
                </fieldset>

                <fieldset>
                    <legend>Live Preview</legend>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="sample-file-select">Sample File</label>
                            <select id="sample-file-select"></select>
                        </div>
                        <div class="form-group">
                            <label for="sample-line-number">Line Number</label>
                            <input type="number" id="sample-line-number" value="1" min="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="preview-input">Preview Input Text</label>
                        <pre id="preview-input"><code>Select a file and line number to see the text here.</code></pre>
                    </div>
                    <div class="form-group">
                        <label for="preview-output">Anonymized Output</label>
                        <pre id="preview-output"><code></code></pre>
                    </div>
                </fieldset>
            </form>
        </div>

        <!-- Model Management Tab Content -->
        <div id="model-management-tab" class="tab-content">
            <h2>Model Management</h2>
            <div class="info-box">
                <h3>ðŸ“¥ Download Models for LogPPT</h3>
                <p>Before running LogPPT, you need to download a pre-trained model from Hugging Face Hub. 
                Recommended models for log parsing include:</p>
                <ul>
                    <li><strong>roberta-base</strong> - Good general-purpose model for log parsing</li>
                    <li><strong>microsoft/codebert-base</strong> - Specialized for code and log analysis</li>
                    <li><strong>distilroberta-base</strong> - Faster, lighter version of RoBERTa</li>
                </ul>
                <p><strong>Note:</strong> The first time you download a model, it may take several minutes depending on your internet connection.</p>
            </div>
            <div class="form-group">
                <label for="model-name-input">Hugging Face Model Name</label>
                <input type="text" id="model-name-input" placeholder="e.g., roberta-base">
                <button id="download-model-btn">Download Model</button>
            </div>
            <h3>Downloaded Models</h3>
            <table id="downloaded-models-table">
                <thead>
                    <tr>
                        <th>Model Name</th>
                        <th>Size (MB)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="downloaded-models-list">
                    <!-- Models will be listed here -->
                </tbody>
            </table>
        </div>

        <!-- LogPPT Tab Content -->
        <div id="logppt-tab" class="tab-content">
            <div class="logppt-container">
                <!-- Left side: Configuration -->
                <div class="logppt-config">
                    <h2>LogPPT Integration</h2>
                    <div class="info-box">
                        <h3>ðŸš€ LogPPT Pipeline</h3>
                        <p>LogPPT (Log Parsing with Prompt Tuning) analyzes your log files to extract event templates and identify variable parameters.</p>
                        <p><strong>Prerequisites:</strong></p>
                        <ul>
                            <li>âœ… Download a model from the "Model Management" tab above</li>
                            <li>âœ… Upload a CSV file with your log data</li>
                            <li>âœ… Ensure your CSV has a 'Content' column or configure content formatting</li>
                        </ul>
                        <p><strong>Process:</strong> The pipeline will sample your data, fine-tune the model, and generate parsed templates.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="logppt-file-upload">Upload Log File (CSV or plain text)</label>
                        <input type="file" id="logppt-file-upload" accept=".csv,.log,.txt">
                        <p class="help-text">You can upload a structured CSV (with columns like Content/EventTemplate) or a plain .log/.txt file. Plain logs will be auto-converted into a single-column dataset named 'Content'.</p>
                    </div>
                    
                    <fieldset>
                        <legend>LogPPT Configuration</legend>
                        <div class="form-group">
                            <label for="logppt-shots">Number of Shots (for sampling)</label>
                            <input type="text" id="logppt-shots" value="8, 16">
                            <p class="help-text">Number of samples to generate for each shot size. For small datasets, use smaller values (1-5). For large datasets, you can use larger values (8, 16, 32).</p>
                        </div>
                        <div class="form-group">
                            <label for="logppt-model-select">Select Model</label>
                            <select id="logppt-model-select">
                                <option value="">-- Select a downloaded model --</option>
                                <!-- Downloaded models will be populated here -->
                            </select>
                            <p class="help-text">Choose a model you've downloaded from the Model Management tab.</p>
                        </div>
                         <div class="form-group">
                            <label for="logppt-max-train-steps">Max Train Steps</label>
                            <input type="number" id="logppt-max-train-steps" value="1000">
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Advanced Configuration</legend>
                        <div class="form-group">
                            <label for="logppt-content-config">Content Field Configuration</label>
                            <textarea id="logppt-content-config" rows="3" placeholder="e.g., {column1} - {column2}"></textarea>
                            <p class="help-text">Define how to construct the 'Content' field for LogPPT using the columns from your data. Use curly braces to denote column names, e.g., {message} or {field1} {field2}.</p>
                        </div>
                        <div class="form-group">
                            <label for="logppt-columns-order">Column Order</label>
                            <input type="text" id="logppt-columns-order" placeholder="e.g., timestamp, level, message">
                            <p class="help-text">Specify the columns to include in the output and their order, separated by commas.</p>
                        </div>
                    </fieldset>
                    
                    <button id="run-logppt-integration-btn">Run LogPPT Process</button>
                    
                    <!-- Progress Bar -->
                    <div id="logppt-progress" style="display: none;">
                        <h3>Pipeline Progress</h3>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                            <div class="progress-text" id="progress-text">0%</div>
                        </div>
                        <div class="progress-steps">
                            <div class="step" id="step-preprocessing">ðŸ“‹ Preprocessing</div>
                            <div class="step" id="step-sampling">ðŸ”„ Sampling</div>
                            <div class="step" id="step-training">ðŸŽ¯ Training</div>
                            <div class="step" id="step-parsing">ðŸ“Š Parsing</div>
                        </div>
                    </div>
                    
                    <div id="logppt-results" style="display: none;">
                        <h3>LogPPT Results</h3>
                        <div id="logppt-evaluation-results"></div>
                        <a id="logppt-download-parsed-link" href="#" target="_blank">Download Parsed Log</a>
                        <a id="logppt-download-templates-link" href="#" target="_blank">Download Templates</a>
                    </div>
                </div>
                
                <!-- Right side: Task Output (always visible) -->
                <div class="logppt-output">
                    <h3>Task Output</h3>
                    <div id="log-output-container">
                        <pre id="log-output">Ready to run LogPPT pipeline...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="log-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Task Output</h2>
            <pre id="log-output"></pre>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
